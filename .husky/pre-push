#!/bin/sh

echo "🔍 Checking for changes in resources/js..."

CHANGED_JS=$(git diff --cached --name-only | grep '^resources/js/')

if [ -z "$CHANGED_JS" ]; then
  echo "✅ No JS changes detected. Skipping build."
  exit 0
fi

echo "📦 JS changes detected. Running build..."
npm run build

if [ $? -ne 0 ]; then
  echo "❌ Build failed. Push blocked."
  exit 1
fi

# Check if build output changed
if git status --porcelain public/build | grep .; then
  echo "📁 Detected changes in public/build — staging them..."
  git add public/build

  echo "📝 Committing updated build..."
  git commit -m "chore: update Vite build (auto-commit from pre-push)" --no-verify
else
  echo "✅ Build output unchanged. No commit needed."
fi

echo "✅ Build succeeded. Proceeding with push."
